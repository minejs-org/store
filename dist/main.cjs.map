{"version":3,"sources":["../src/mod/storage.ts","../src/mod/store.ts","../src/mod/indexed_db_storage.ts"],"names":["Storage","options","type","key","defaultValue","fullKey","raw","item","error","value","ttl","createStorageSignal","storage","localStorage","initialValue","sig","signal","effect","sessionStorage","e","memoryStorage","Store","config","snapshot","updates","batch","callback","createStore","IndexedDBStorage","dbName","storeName","resolve","reject","request","event","db"],"mappings":"oDAkBW,IAAMA,CAAAA,CAAN,KAAc,CAMjB,WAAA,CAAYC,CAAAA,CAAgC,EAAC,CAAG,CAC5C,IAAMC,CAAAA,CAAOD,CAAAA,CAAQ,IAAA,EAAQ,OAAA,CAM7B,OALA,IAAA,CAAK,MAAA,CAASA,CAAAA,CAAQ,MAAA,EAAU,OAAA,CAChC,IAAA,CAAK,SAAA,CAAYA,CAAAA,CAAQ,WAAa,IAAA,CAAK,SAAA,CAC3C,IAAA,CAAK,WAAA,CAAcA,CAAAA,CAAQ,WAAA,EAAe,IAAA,CAAK,KAAA,CAGvCC,CAAAA,EACJ,KAAK,OAAA,CACD,IAAA,CAAK,OAAA,CAAU,WAAW,YAAA,CAC1B,MACJ,KAAK,SAAA,CACD,IAAA,CAAK,OAAA,CAAU,UAAA,CAAW,cAAA,CAC1B,MACJ,KAAK,QAAA,CACD,IAAA,CAAK,OAAA,CAAU,IAAI,IACnB,KACR,CACJ,CAKO,GAAA,CAAaC,CAAAA,CAAaC,CAAAA,CAA4B,CACzD,IAAMC,CAAAA,CAAU,IAAA,CAAK,MAAA,CAASF,CAAAA,CAE9B,GAAI,CACA,IAAMG,CAAAA,CAAM,IAAA,CAAK,OAAA,YAAmB,GAAA,CAC9B,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAID,CAAO,CAAA,CACxB,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQA,CAAO,CAAA,CAElC,GAAIC,CAAAA,EAAQ,IAAA,CACR,OAAOF,CAAAA,GAAiB,KAAA,CAAA,CAAYA,CAAAA,CAAe,IAAA,CAGvD,IAAMG,CAAAA,CAA6B,IAAA,CAAK,WAAA,CAAYD,CAAG,CAAA,CAGvD,OAAIC,CAAAA,CAAK,GAAA,EAAO,IAAA,CAAK,GAAA,EAAI,CAAIA,CAAAA,CAAK,SAAA,CAAYA,CAAAA,CAAK,GAAA,EAC/C,IAAA,CAAK,MAAA,CAAOJ,CAAG,CAAA,CACRC,CAAAA,GAAiB,KAAA,CAAA,CAAYA,CAAAA,CAAe,MAGhDG,CAAAA,CAAK,KAChB,CAAA,MAASC,CAAAA,CAAO,CACZ,OAAA,OAAA,CAAQ,KAAA,CAAM,oBAAA,CAAsBA,CAAK,CAAA,CAClCJ,CAAAA,GAAiB,MAAA,CAAYA,CAAAA,CAAe,IACvD,CACJ,CAKO,GAAA,CAAaD,CAAAA,CAAaM,CAAAA,CAAUC,CAAAA,CAAoB,CAC3D,IAAML,CAAAA,CAAU,IAAA,CAAK,MAAA,CAASF,CAAAA,CAE9B,GAAI,CACA,IAAMI,EAA6B,CAC/B,KAAA,CAAAE,CAAAA,CACA,SAAA,CAAW,IAAA,CAAK,GAAA,EAAI,CACpB,GAAA,CAAAC,CACJ,CAAA,CAEMJ,CAAAA,CAAM,IAAA,CAAK,SAAA,CAAUC,CAAI,CAAA,CAE3B,IAAA,CAAK,OAAA,YAAmB,GAAA,CACxB,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAIF,CAAAA,CAASC,CAAG,CAAA,CAE7B,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQD,CAAAA,CAASC,CAAG,EAEzC,OAASE,CAAAA,CAAO,CACZ,OAAA,CAAQ,KAAA,CAAM,oBAAA,CAAsBA,CAAK,EAC7C,CACJ,CAKO,MAAA,CAAOL,CAAAA,CAAmB,CAC7B,IAAME,CAAAA,CAAU,KAAK,MAAA,CAASF,CAAAA,CAE9B,GAAI,CACI,IAAA,CAAK,OAAA,YAAmB,GAAA,CACxB,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAOE,CAAO,CAAA,CAE3B,IAAA,CAAK,OAAA,CAAQ,WAAWA,CAAO,EAEvC,CAAA,MAASG,CAAAA,CAAO,CACZ,OAAA,CAAQ,KAAA,CAAM,uBAAA,CAAyBA,CAAK,EAChD,CACJ,CAKO,KAAA,EAAc,CACjB,GAAI,CACI,IAAA,CAAK,OAAA,YAAmB,GAAA,CACxB,IAAA,CAAK,OAAA,CAAQ,KAAA,EAAM,CAGN,MAAA,CAAO,IAAA,CAAK,IAAA,CAAK,OAAO,CAAA,CAChC,OAAA,CAAQL,CAAAA,EAAO,CACZA,CAAAA,CAAI,UAAA,CAAW,IAAA,CAAK,MAAM,CAAA,EACzB,IAAA,CAAK,OAAA,CAA+B,UAAA,CAAWA,CAAG,EAE3D,CAAC,EAET,CAAA,MAASK,CAAAA,CAAO,CACZ,OAAA,CAAQ,KAAA,CAAM,sBAAA,CAAwBA,CAAK,EAC/C,CACJ,CAKO,IAAA,EAAiB,CACpB,GAAI,CACA,OAAI,IAAA,CAAK,OAAA,YAAmB,IACjB,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,OAAA,CAAQ,IAAA,EAAM,CAAA,CAChC,MAAA,CAAOL,CAAAA,EAAOA,CAAAA,CAAI,UAAA,CAAW,IAAA,CAAK,MAAM,CAAC,CAAA,CACzC,GAAA,CAAIA,CAAAA,EAAOA,CAAAA,CAAI,KAAA,CAAM,IAAA,CAAK,MAAA,CAAO,MAAM,CAAC,CAAA,CAEtC,MAAA,CAAO,IAAA,CAAK,IAAA,CAAK,OAAO,CAAA,CAC1B,MAAA,CAAOA,GAAOA,CAAAA,CAAI,UAAA,CAAW,IAAA,CAAK,MAAM,CAAC,CAAA,CACzC,GAAA,CAAIA,CAAAA,EAAOA,CAAAA,CAAI,KAAA,CAAM,IAAA,CAAK,MAAA,CAAO,MAAM,CAAC,CAErD,CAAA,MAASK,CAAAA,CAAO,CACZ,OAAA,OAAA,CAAQ,KAAA,CAAM,qBAAA,CAAuBA,CAAK,CAAA,CACnC,EACX,CACJ,CAKO,GAAA,CAAIL,CAAAA,CAAsB,CAC7B,OAAO,IAAA,CAAK,GAAA,CAAIA,CAAG,CAAA,GAAM,IAC7B,CACJ,EAKO,SAASQ,CAAAA,CACZR,CAAAA,CACAC,CAAAA,CACAQ,CAAAA,CAAmBC,CAAAA,CACV,CAET,IAAMC,CAAAA,CAAeF,CAAAA,CAAQ,GAAA,CAAOT,CAAAA,CAAKC,CAAY,CAAA,CAC/CW,CAAAA,CAAMC,cAAAA,CAAUF,CAAa,CAAA,CAGnC,OAAAG,cAAAA,CAAO,IAAM,CACTL,EAAQ,GAAA,CAAIT,CAAAA,CAAKY,CAAAA,EAAK,EAC1B,CAAC,CAAA,CAAA,CAGGH,CAAAA,GAAYC,CAAAA,EAAgBD,CAAAA,GAAYM,CAAAA,GACxC,MAAA,CAAO,gBAAA,CAAiB,SAAA,CAAYC,GAAM,CACtC,GAAIA,CAAAA,CAAE,GAAA,GAAQhB,CAAAA,EAAOgB,CAAAA,CAAE,QAAA,CACnB,GAAI,CACA,IAAMZ,CAAAA,CAA6B,IAAA,CAAK,KAAA,CAAMY,CAAAA,CAAE,QAAQ,CAAA,CACxDJ,CAAAA,CAAI,GAAA,CAAIR,CAAAA,CAAK,KAAK,EACtB,CAAA,KAAQ,CAER,CAER,CAAC,CAAA,CAGEQ,CACX,CAQO,IAAMF,CAAAA,CAAiB,IAAIb,CAAAA,CAAQ,CAAE,IAAA,CAAM,OAAQ,CAAC,CAAA,CAC9CkB,CAAAA,CAAiB,IAAIlB,CAAAA,CAAQ,CAAE,IAAA,CAAM,SAAU,CAAC,CAAA,CAChDoB,EAAiB,IAAIpB,CAAAA,CAAQ,CAAE,IAAA,CAAM,QAAS,CAAC,EC5LrD,IAAMqB,EAAN,KAA2C,CAK9C,WAAA,CAAYC,CAAAA,CAA8B,CAF1C,IAAA,CAAQ,WAAA,CAAc,IAAI,GAAA,CAGtB,IAAA,CAAK,MAAA,CAASA,CAAAA,CAGd,IAAA,CAAK,MAAA,CAAS,EAAC,CAEf,MAAA,CAAO,OAAA,CAAQA,CAAAA,CAAO,KAAK,CAAA,CAAE,OAAA,CAAQ,CAAC,CAACnB,CAAAA,CAAKM,CAAK,CAAA,GAAM,CAC/Ca,CAAAA,CAAO,OAAA,EAAWA,CAAAA,CAAO,OAAA,CAEzB,IAAA,CAAK,MAAA,CAAOnB,CAAc,CAAA,CAAIQ,CAAAA,CAC1B,CAAA,EAAGW,CAAAA,CAAO,UAAA,EAAc,OAAO,CAAA,CAAA,EAAInB,CAAG,CAAA,CAAA,CACtCM,CAAAA,CACAa,EAAO,OACX,CAAA,CAGA,IAAA,CAAK,MAAA,CAAOnB,CAAc,CAAA,CAAIa,cAAAA,CAAOP,CAAK,EAElD,CAAC,EACL,CAKA,IAAW,KAAA,EAA0C,CACjD,OAAO,IAAA,CAAK,MAChB,CAKO,WAAA,EAAiB,CACpB,IAAMc,CAAAA,CAAW,EAAC,CAElB,OAAA,MAAA,CAAO,OAAA,CAAQ,IAAA,CAAK,MAAM,EAAE,OAAA,CAAQ,CAAC,CAACpB,CAAAA,CAAKY,CAAG,CAAA,GAAM,CAChDQ,CAAAA,CAASpB,CAAc,CAAA,CAAKY,CAAAA,GAChC,CAAC,CAAA,CAEMQ,CACX,CAKO,QAAA,CAASC,CAAAA,CAA2B,CACvCC,aAAAA,CAAM,IAAM,CACR,MAAA,CAAO,OAAA,CAAQD,CAAO,CAAA,CAAE,OAAA,CAAQ,CAAC,CAACrB,EAAKM,CAAK,CAAA,GAAM,CAC1CN,CAAAA,IAAO,IAAA,CAAK,MAAA,EACZ,IAAA,CAAK,MAAA,CAAOA,CAAc,CAAA,CAAE,GAAA,CAAIM,CAAK,EAE7C,CAAC,EACL,CAAC,CAAA,CAED,IAAA,CAAK,MAAA,GACT,CAKO,SAAA,CAAUiB,CAAAA,CAAkC,CAC/C,OAAA,IAAA,CAAK,WAAA,CAAY,GAAA,CAAIA,CAAQ,CAAA,CAEtB,IAAM,CACT,IAAA,CAAK,WAAA,CAAY,MAAA,CAAOA,CAAQ,EACpC,CACJ,CAEQ,MAAA,EAAe,CACnB,IAAA,CAAK,WAAA,CAAY,OAAA,CAAQA,CAAAA,EAAYA,CAAAA,EAAU,EACnD,CAKO,KAAA,EAAc,CACjB,IAAA,CAAK,QAAA,CAAS,IAAA,CAAK,MAAA,CAAO,KAAK,EACnC,CAKO,cAAA,EAAuB,CACtB,IAAA,CAAK,OAAO,OAAA,EAAW,IAAA,CAAK,MAAA,CAAO,OAAA,EACnC,MAAA,CAAO,IAAA,CAAK,IAAA,CAAK,MAAA,CAAO,KAAK,CAAA,CAAE,OAAA,CAAQvB,CAAAA,EAAO,CAC1C,IAAA,CAAK,OAAO,OAAA,CAAS,MAAA,CAAO,CAAA,EAAG,IAAA,CAAK,MAAA,CAAO,UAAA,EAAc,OAAO,CAAA,CAAA,EAAIA,CAAG,CAAA,CAAE,EAC7E,CAAC,EAET,CACJ,EAKO,SAASwB,CAAAA,CACZL,CAAAA,CACQ,CACR,OAAO,IAAID,CAAAA,CAAMC,CAAM,CAC3B,CCzGO,IAAMM,CAAAA,CAAN,KAAuB,CAK1B,WAAA,CAAYC,CAAAA,CAAS,SAAA,CAAWC,CAAAA,CAAY,OAAA,CAAS,CAFrD,IAAA,CAAQ,EAAA,CAAyB,IAAA,CAG7B,IAAA,CAAK,MAAA,CAASD,CAAAA,CACd,IAAA,CAAK,SAAA,CAAYC,EACrB,CAEA,MAAc,MAAA,EAA+B,CACzC,OAAI,IAAA,CAAK,EAAA,CAAW,IAAA,CAAK,EAAA,CAElB,IAAI,OAAA,CAAQ,CAACC,CAAAA,CAASC,CAAAA,GAAW,CACpC,IAAMC,EAAU,SAAA,CAAU,IAAA,CAAK,IAAA,CAAK,MAAA,CAAQ,CAAC,CAAA,CAE7CA,CAAAA,CAAQ,OAAA,CAAU,IAAMD,CAAAA,CAAOC,CAAAA,CAAQ,KAAK,CAAA,CAC5CA,CAAAA,CAAQ,UAAY,IAAM,CACtB,IAAA,CAAK,EAAA,CAAKA,CAAAA,CAAQ,MAAA,CAClBF,CAAAA,CAAQ,IAAA,CAAK,EAAE,EACnB,CAAA,CAEAE,CAAAA,CAAQ,eAAA,CAAmBC,CAAAA,EAAU,CACjC,IAAMC,CAAAA,CAAMD,CAAAA,CAAM,MAAA,CAA4B,MAAA,CACzCC,CAAAA,CAAG,gBAAA,CAAiB,QAAA,CAAS,IAAA,CAAK,SAAS,CAAA,EAC5CA,CAAAA,CAAG,iBAAA,CAAkB,IAAA,CAAK,SAAS,EAE3C,EACJ,CAAC,CACL,CAEA,MAAa,GAAA,CAAahC,CAAAA,CAAgC,CACtD,IAAMgC,CAAAA,CAAK,MAAM,IAAA,CAAK,MAAA,EAAO,CAE7B,OAAO,IAAI,OAAA,CAAQ,CAACJ,CAAAA,CAASC,CAAAA,GAAW,CAGpC,IAAMC,CAAAA,CAFcE,CAAAA,CAAG,WAAA,CAAY,IAAA,CAAK,SAAA,CAAW,UAAU,CAAA,CACnC,YAAY,IAAA,CAAK,SAAS,CAAA,CAC9B,GAAA,CAAIhC,CAAG,CAAA,CAE7B8B,CAAAA,CAAQ,OAAA,CAAU,IAAMD,CAAAA,CAAOC,CAAAA,CAAQ,KAAK,CAAA,CAC5CA,CAAAA,CAAQ,SAAA,CAAY,IAAMF,CAAAA,CAAQE,CAAAA,CAAQ,MAAA,EAAU,IAAI,EAC5D,CAAC,CACL,CAEA,MAAa,GAAA,CAAa9B,CAAAA,CAAaM,CAAAA,CAAyB,CAC5D,IAAM0B,EAAK,MAAM,IAAA,CAAK,MAAA,EAAO,CAE7B,OAAO,IAAI,OAAA,CAAQ,CAACJ,CAAAA,CAASC,CAAAA,GAAW,CAGpC,IAAMC,CAAAA,CAFcE,CAAAA,CAAG,YAAY,IAAA,CAAK,SAAA,CAAW,WAAW,CAAA,CACpC,WAAA,CAAY,IAAA,CAAK,SAAS,CAAA,CAC9B,GAAA,CAAI1B,CAAAA,CAAON,CAAG,CAAA,CAEpC8B,CAAAA,CAAQ,OAAA,CAAU,IAAMD,CAAAA,CAAOC,CAAAA,CAAQ,KAAK,CAAA,CAC5CA,CAAAA,CAAQ,SAAA,CAAY,IAAMF,CAAAA,GAC9B,CAAC,CACL,CAEA,MAAa,MAAA,CAAO5B,CAAAA,CAA4B,CAC5C,IAAMgC,CAAAA,CAAK,MAAM,IAAA,CAAK,MAAA,EAAO,CAE7B,OAAO,IAAI,OAAA,CAAQ,CAACJ,CAAAA,CAASC,CAAAA,GAAW,CAGpC,IAAMC,EAFcE,CAAAA,CAAG,WAAA,CAAY,IAAA,CAAK,SAAA,CAAW,WAAW,CAAA,CACpC,WAAA,CAAY,IAAA,CAAK,SAAS,CAAA,CAC9B,MAAA,CAAOhC,CAAG,CAAA,CAEhC8B,CAAAA,CAAQ,QAAU,IAAMD,CAAAA,CAAOC,CAAAA,CAAQ,KAAK,CAAA,CAC5CA,CAAAA,CAAQ,SAAA,CAAY,IAAMF,CAAAA,GAC9B,CAAC,CACL,CAEA,MAAa,OAAuB,CAChC,IAAMI,CAAAA,CAAK,MAAM,IAAA,CAAK,MAAA,EAAO,CAE7B,OAAO,IAAI,OAAA,CAAQ,CAACJ,CAAAA,CAASC,CAAAA,GAAW,CAGpC,IAAMC,CAAAA,CAFcE,CAAAA,CAAG,WAAA,CAAY,IAAA,CAAK,SAAA,CAAW,WAAW,CAAA,CACpC,WAAA,CAAY,IAAA,CAAK,SAAS,CAAA,CAC9B,KAAA,EAAM,CAE5BF,CAAAA,CAAQ,OAAA,CAAU,IAAMD,CAAAA,CAAOC,CAAAA,CAAQ,KAAK,CAAA,CAC5CA,CAAAA,CAAQ,SAAA,CAAY,IAAMF,CAAAA,GAC9B,CAAC,CACL,CAEA,MAAa,IAAA,EAA0B,CACnC,IAAMI,CAAAA,CAAK,MAAM,IAAA,CAAK,MAAA,EAAO,CAE7B,OAAO,IAAI,OAAA,CAAQ,CAACJ,CAAAA,CAASC,CAAAA,GAAW,CAGpC,IAAMC,EAFcE,CAAAA,CAAG,WAAA,CAAY,IAAA,CAAK,SAAA,CAAW,UAAU,CAAA,CACnC,WAAA,CAAY,IAAA,CAAK,SAAS,CAAA,CAC9B,UAAA,EAAW,CAEjCF,CAAAA,CAAQ,OAAA,CAAU,IAAMD,CAAAA,CAAOC,CAAAA,CAAQ,KAAK,CAAA,CAC5CA,CAAAA,CAAQ,SAAA,CAAY,IAAMF,CAAAA,CAAQE,CAAAA,CAAQ,MAAkB,EAChE,CAAC,CACL,CACJ","file":"main.cjs","sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\r\n// src/mod/Storage.ts\r\n//\r\n// Made with ❤️ by Maysara.\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\r\n\r\n    import { signal, effect, type Signal } from '@minejs/signals';\r\n    import * as types from '../types';\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\r\n\r\n    export class Storage {\r\n        private storage: globalThis.Storage | Map<string, string>;\r\n        private prefix: string;\r\n        private serialize: (value: any) => string;\r\n        private deserialize: (value: string) => any;\r\n\r\n        constructor(options: types.StorageOptions = {}) {\r\n            const type = options.type || 'local';\r\n            this.prefix = options.prefix || 'crux:';\r\n            this.serialize = options.serialize || JSON.stringify;\r\n            this.deserialize = options.deserialize || JSON.parse;\r\n\r\n            // Select storage backend\r\n            switch (type) {\r\n                case 'local':\r\n                    this.storage = globalThis.localStorage;\r\n                    break;\r\n                case 'session':\r\n                    this.storage = globalThis.sessionStorage;\r\n                    break;\r\n                case 'memory':\r\n                    this.storage = new Map();\r\n                    break;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Get item from storage\r\n         */\r\n        public get<T = any>(key: string, defaultValue?: T): T | null {\r\n            const fullKey = this.prefix + key;\r\n\r\n            try {\r\n                const raw = this.storage instanceof Map\r\n                    ? this.storage.get(fullKey)\r\n                    : this.storage.getItem(fullKey);\r\n\r\n                if (raw === null || raw === undefined) {\r\n                    return defaultValue !== undefined ? defaultValue : null;\r\n                }\r\n\r\n                const item: types.StorageItem<T> = this.deserialize(raw);\r\n\r\n                // Check TTL\r\n                if (item.ttl && Date.now() - item.timestamp > item.ttl) {\r\n                    this.remove(key);\r\n                    return defaultValue !== undefined ? defaultValue : null;\r\n                }\r\n\r\n                return item.value;\r\n            } catch (error) {\r\n                console.error('Storage get error:', error);\r\n                return defaultValue !== undefined ? defaultValue : null;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Set item in storage\r\n         */\r\n        public set<T = any>(key: string, value: T, ttl?: number): void {\r\n            const fullKey = this.prefix + key;\r\n\r\n            try {\r\n                const item: types.StorageItem<T> = {\r\n                    value,\r\n                    timestamp: Date.now(),\r\n                    ttl\r\n                };\r\n\r\n                const raw = this.serialize(item);\r\n\r\n                if (this.storage instanceof Map) {\r\n                    this.storage.set(fullKey, raw);\r\n                } else {\r\n                    this.storage.setItem(fullKey, raw);\r\n                }\r\n            } catch (error) {\r\n                console.error('Storage set error:', error);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Remove item from storage\r\n         */\r\n        public remove(key: string): void {\r\n            const fullKey = this.prefix + key;\r\n\r\n            try {\r\n                if (this.storage instanceof Map) {\r\n                    this.storage.delete(fullKey);\r\n                } else {\r\n                    this.storage.removeItem(fullKey);\r\n                }\r\n            } catch (error) {\r\n                console.error('Storage remove error:', error);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Clear all items\r\n         */\r\n        public clear(): void {\r\n            try {\r\n                if (this.storage instanceof Map) {\r\n                    this.storage.clear();\r\n                } else {\r\n                    // Only clear items with our prefix\r\n                    const keys = Object.keys(this.storage);\r\n                    keys.forEach(key => {\r\n                        if (key.startsWith(this.prefix)) {\r\n                            (this.storage as globalThis.Storage).removeItem(key);\r\n                        }\r\n                    });\r\n                }\r\n            } catch (error) {\r\n                console.error('Storage clear error:', error);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Get all keys\r\n         */\r\n        public keys(): string[] {\r\n            try {\r\n                if (this.storage instanceof Map) {\r\n                    return Array.from(this.storage.keys())\r\n                        .filter(key => key.startsWith(this.prefix))\r\n                        .map(key => key.slice(this.prefix.length));\r\n                } else {\r\n                    return Object.keys(this.storage)\r\n                        .filter(key => key.startsWith(this.prefix))\r\n                        .map(key => key.slice(this.prefix.length));\r\n                }\r\n            } catch (error) {\r\n                console.error('Storage keys error:', error);\r\n                return [];\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Check if key exists\r\n         */\r\n        public has(key: string): boolean {\r\n            return this.get(key) !== null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create a reactive signal backed by storage\r\n     */\r\n    export function createStorageSignal<T>(\r\n        key: string,\r\n        defaultValue: T,\r\n        storage: Storage = localStorage\r\n    ): Signal<T> {\r\n        // Initialize with stored value\r\n        const initialValue = storage.get<T>(key, defaultValue);\r\n        const sig = signal<T>(initialValue!);\r\n\r\n        // Sync to storage on change\r\n        effect(() => {\r\n            storage.set(key, sig());\r\n        });\r\n\r\n        // Listen to storage events (for cross-tab sync)\r\n        if (storage === localStorage || storage === sessionStorage) {\r\n            window.addEventListener('storage', (e) => {\r\n                if (e.key === key && e.newValue) {\r\n                    try {\r\n                        const item: types.StorageItem<T> = JSON.parse(e.newValue);\r\n                        sig.set(item.value);\r\n                    } catch {\r\n                        // Ignore parse errors\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        return sig;\r\n    }\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ ════ ════════════════════════════════════════╗\r\n\r\n    export const localStorage   = new Storage({ type: 'local' });\r\n    export const sessionStorage = new Storage({ type: 'session' });\r\n    export const memoryStorage  = new Storage({ type: 'memory' });\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\n// src/mod/Store.ts\r\n//\r\n// Made with ❤️ by Maysara.\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\r\n\r\n    import { signal, batch, type Signal } from '@minejs/signals';\r\n    import * as types from '../types';\r\n    import { createStorageSignal } from './storage';\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\r\n\r\n    export class Store<T extends Record<string, any>> {\r\n        private _state: { [K in keyof T]: Signal<T[K]> };\r\n        private config: types.StoreConfig<T>;\r\n        private subscribers = new Set<() => void>();\r\n\r\n        constructor(config: types.StoreConfig<T>) {\r\n            this.config = config;\r\n\r\n            // Create signals for each state property\r\n            this._state = {} as any;\r\n\r\n            Object.entries(config.state).forEach(([key, value]) => {\r\n                if (config.persist && config.storage) {\r\n                    // Use storage-backed signal\r\n                    this._state[key as keyof T] = createStorageSignal(\r\n                        `${config.storageKey || 'store'}:${key}`,\r\n                        value,\r\n                        config.storage\r\n                    );\r\n                } else {\r\n                    // Use regular signal\r\n                    this._state[key as keyof T] = signal(value);\r\n                }\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Get state (reactive)\r\n         */\r\n        public get state(): { [K in keyof T]: Signal<T[K]> } {\r\n            return this._state;\r\n        }\r\n\r\n        /**\r\n         * Get snapshot (non-reactive)\r\n         */\r\n        public getSnapshot(): T {\r\n            const snapshot = {} as T;\r\n\r\n            Object.entries(this._state).forEach(([key, sig]) => {\r\n                snapshot[key as keyof T] = (sig as Signal<any>)();\r\n            });\r\n\r\n            return snapshot;\r\n        }\r\n\r\n        /**\r\n         * Set state (batch update)\r\n         */\r\n        public setState(updates: Partial<T>): void {\r\n            batch(() => {\r\n                Object.entries(updates).forEach(([key, value]) => {\r\n                    if (key in this._state) {\r\n                        this._state[key as keyof T].set(value);\r\n                    }\r\n                });\r\n            });\r\n\r\n            this.notify();\r\n        }\r\n\r\n        /**\r\n         * Subscribe to state changes\r\n         */\r\n        public subscribe(callback: () => void): () => void {\r\n            this.subscribers.add(callback);\r\n\r\n            return () => {\r\n                this.subscribers.delete(callback);\r\n            };\r\n        }\r\n\r\n        private notify(): void {\r\n            this.subscribers.forEach(callback => callback());\r\n        }\r\n\r\n        /**\r\n         * Reset to initial state\r\n         */\r\n        public reset(): void {\r\n            this.setState(this.config.state);\r\n        }\r\n\r\n        /**\r\n         * Clear persisted data\r\n         */\r\n        public clearPersisted(): void {\r\n            if (this.config.persist && this.config.storage) {\r\n                Object.keys(this.config.state).forEach(key => {\r\n                    this.config.storage!.remove(`${this.config.storageKey || 'store'}:${key}`);\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create a global store\r\n     */\r\n    export function createStore<T extends Record<string, any>>(\r\n        config: types.StoreConfig<T>\r\n    ): Store<T> {\r\n        return new Store(config);\r\n    }\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ ════ ════════════════════════════════════════╗\r\n\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\n// src/mod/IndexedDBStorage.ts\r\n//\r\n// Made with ❤️ by Maysara.\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ PACK ════════════════════════════════════════╗\r\n\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n\r\n\r\n\r\n// ╔════════════════════════════════════════ CORE ════════════════════════════════════════╗\r\n\r\n    export class IndexedDBStorage {\r\n        private dbName: string;\r\n        private storeName: string;\r\n        private db: IDBDatabase | null = null;\r\n\r\n        constructor(dbName = 'crux-db', storeName = 'store') {\r\n            this.dbName = dbName;\r\n            this.storeName = storeName;\r\n        }\r\n\r\n        private async openDB(): Promise<IDBDatabase> {\r\n            if (this.db) return this.db;\r\n\r\n            return new Promise((resolve, reject) => {\r\n                const request = indexedDB.open(this.dbName, 1);\r\n\r\n                request.onerror = () => reject(request.error);\r\n                request.onsuccess = () => {\r\n                    this.db = request.result;\r\n                    resolve(this.db);\r\n                };\r\n\r\n                request.onupgradeneeded = (event) => {\r\n                    const db = (event.target as IDBOpenDBRequest).result;\r\n                    if (!db.objectStoreNames.contains(this.storeName)) {\r\n                        db.createObjectStore(this.storeName);\r\n                    }\r\n                };\r\n            });\r\n        }\r\n\r\n        public async get<T = any>(key: string): Promise<T | null> {\r\n            const db = await this.openDB();\r\n\r\n            return new Promise((resolve, reject) => {\r\n                const transaction = db.transaction(this.storeName, 'readonly');\r\n                const store = transaction.objectStore(this.storeName);\r\n                const request = store.get(key);\r\n\r\n                request.onerror = () => reject(request.error);\r\n                request.onsuccess = () => resolve(request.result || null);\r\n            });\r\n        }\r\n\r\n        public async set<T = any>(key: string, value: T): Promise<void> {\r\n            const db = await this.openDB();\r\n\r\n            return new Promise((resolve, reject) => {\r\n                const transaction = db.transaction(this.storeName, 'readwrite');\r\n                const store = transaction.objectStore(this.storeName);\r\n                const request = store.put(value, key);\r\n\r\n                request.onerror = () => reject(request.error);\r\n                request.onsuccess = () => resolve();\r\n            });\r\n        }\r\n\r\n        public async remove(key: string): Promise<void> {\r\n            const db = await this.openDB();\r\n\r\n            return new Promise((resolve, reject) => {\r\n                const transaction = db.transaction(this.storeName, 'readwrite');\r\n                const store = transaction.objectStore(this.storeName);\r\n                const request = store.delete(key);\r\n\r\n                request.onerror = () => reject(request.error);\r\n                request.onsuccess = () => resolve();\r\n            });\r\n        }\r\n\r\n        public async clear(): Promise<void> {\r\n            const db = await this.openDB();\r\n\r\n            return new Promise((resolve, reject) => {\r\n                const transaction = db.transaction(this.storeName, 'readwrite');\r\n                const store = transaction.objectStore(this.storeName);\r\n                const request = store.clear();\r\n\r\n                request.onerror = () => reject(request.error);\r\n                request.onsuccess = () => resolve();\r\n            });\r\n        }\r\n\r\n        public async keys(): Promise<string[]> {\r\n            const db = await this.openDB();\r\n\r\n            return new Promise((resolve, reject) => {\r\n                const transaction = db.transaction(this.storeName, 'readonly');\r\n                const store = transaction.objectStore(this.storeName);\r\n                const request = store.getAllKeys();\r\n\r\n                request.onerror = () => reject(request.error);\r\n                request.onsuccess = () => resolve(request.result as string[]);\r\n            });\r\n        }\r\n    }\r\n\r\n// ╚══════════════════════════════════════════════════════════════════════════════════════╝\r\n"]}