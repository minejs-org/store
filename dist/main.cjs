'use strict';var signals=require('@minejs/signals');var c=class{constructor(e={}){let t=e.type||"local";switch(this.prefix=e.prefix||"crux:",this.serialize=e.serialize||JSON.stringify,this.deserialize=e.deserialize||JSON.parse,t){case "local":this.storage=globalThis.localStorage;break;case "session":this.storage=globalThis.sessionStorage;break;case "memory":this.storage=new Map;break}}get(e,t){let r=this.prefix+e;try{let s=this.storage instanceof Map?this.storage.get(r):this.storage.getItem(r);if(s==null)return t!==void 0?t:null;let o=this.deserialize(s);return o.ttl&&Date.now()-o.timestamp>o.ttl?(this.remove(e),t!==void 0?t:null):o.value}catch(s){return console.error("Storage get error:",s),t!==void 0?t:null}}set(e,t,r){let s=this.prefix+e;try{let o={value:t,timestamp:Date.now(),ttl:r},i=this.serialize(o);this.storage instanceof Map?this.storage.set(s,i):this.storage.setItem(s,i);}catch(o){console.error("Storage set error:",o);}}remove(e){let t=this.prefix+e;try{this.storage instanceof Map?this.storage.delete(t):this.storage.removeItem(t);}catch(r){console.error("Storage remove error:",r);}}clear(){try{this.storage instanceof Map?this.storage.clear():Object.keys(this.storage).forEach(t=>{t.startsWith(this.prefix)&&this.storage.removeItem(t);});}catch(e){console.error("Storage clear error:",e);}}keys(){try{return this.storage instanceof Map?Array.from(this.storage.keys()).filter(e=>e.startsWith(this.prefix)).map(e=>e.slice(this.prefix.length)):Object.keys(this.storage).filter(e=>e.startsWith(this.prefix)).map(e=>e.slice(this.prefix.length))}catch(e){return console.error("Storage keys error:",e),[]}}has(e){return this.get(e)!==null}};function p(n,e,t=h){let r=t.get(n,e),s=signals.signal(r);return signals.effect(()=>{t.set(n,s());}),(t===h||t===m)&&window.addEventListener("storage",o=>{if(o.key===n&&o.newValue)try{let i=JSON.parse(o.newValue);s.set(i.value);}catch{}}),s}var h=new c({type:"local"}),m=new c({type:"session"}),y=new c({type:"memory"});var l=class{constructor(e){this.subscribers=new Set;this.config=e,this._state={},Object.entries(e.state).forEach(([t,r])=>{e.persist&&e.storage?this._state[t]=p(`${e.storageKey||"store"}:${t}`,r,e.storage):this._state[t]=signals.signal(r);});}get state(){return this._state}getSnapshot(){let e={};return Object.entries(this._state).forEach(([t,r])=>{e[t]=r();}),e}setState(e){signals.batch(()=>{Object.entries(e).forEach(([t,r])=>{t in this._state&&this._state[t].set(r);});}),this.notify();}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e);}}notify(){this.subscribers.forEach(e=>e());}reset(){this.setState(this.config.state);}clearPersisted(){this.config.persist&&this.config.storage&&Object.keys(this.config.state).forEach(e=>{this.config.storage.remove(`${this.config.storageKey||"store"}:${e}`);});}};function T(n){return new l(n)}var u=class{constructor(e="crux-db",t="store"){this.db=null;this.dbName=e,this.storeName=t;}async openDB(){return this.db?this.db:new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>{this.db=r.result,e(this.db);},r.onupgradeneeded=s=>{let o=s.target.result;o.objectStoreNames.contains(this.storeName)||o.createObjectStore(this.storeName);};})}async get(e){let t=await this.openDB();return new Promise((r,s)=>{let a=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);a.onerror=()=>s(a.error),a.onsuccess=()=>r(a.result||null);})}async set(e,t){let r=await this.openDB();return new Promise((s,o)=>{let g=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(t,e);g.onerror=()=>o(g.error),g.onsuccess=()=>s();})}async remove(e){let t=await this.openDB();return new Promise((r,s)=>{let a=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);a.onerror=()=>s(a.error),a.onsuccess=()=>r();})}async clear(){let e=await this.openDB();return new Promise((t,r)=>{let i=e.transaction(this.storeName,"readwrite").objectStore(this.storeName).clear();i.onerror=()=>r(i.error),i.onsuccess=()=>t();})}async keys(){let e=await this.openDB();return new Promise((t,r)=>{let i=e.transaction(this.storeName,"readonly").objectStore(this.storeName).getAllKeys();i.onerror=()=>r(i.error),i.onsuccess=()=>t(i.result);})}};exports.IndexedDBStorage=u;exports.Storage=c;exports.Store=l;exports.createStorageSignal=p;exports.createStore=T;exports.localStorage=h;exports.memoryStorage=y;exports.sessionStorage=m;//# sourceMappingURL=main.cjs.map
//# sourceMappingURL=main.cjs.map